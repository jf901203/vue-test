<template>
<div>
  <div class="shopgoods">
    <div class="menu-wrapper" ref="menu_wrapper">
			 <ul class="menu-content">
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>
				 <li class="menu-item">
					 <span v-if="isshow">
						 <img src="./img/1.png" alt="" class="icon">
					 </span>
					 <span>优惠</span>
				 </li>

				 
				 
			 </ul>
		</div>
		<div class="food-wrapper" ref="food_wrapper">
        <ul class="food-content">
				 <li class="food-item">
					 <h3 class="food-title">优惠</h3>
					 <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					 
				 </li>
				<li class="food-item">
					 <h3 class="food-title">优惠</h3>
					 <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					 
				 </li>
				 <li class="food-item">
					 <h3 class="food-title">优惠</h3>
					 <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					 
				 </li>
				 <li class="food-item">
					 <h3 class="food-title">优惠</h3>
					 <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					  <ul class="food-list">
						 <li class="food-avatar">
							 <img  src="./img/1.jpeg" alt="">
						 </li>
						 <li class="food-text">
							 <ul class="food-line">
								 <li class="line-title">南瓜粥</li>
								 <li class="line-des">甜粥</li>
								 <li class="line-num">
									 <span>月售91份</span>
									 <span>好评率100%</span>
								 </li>
								 <li class="line-order">
									 ￥9
								 </li>
							 </ul>
						 </li>
					 </ul>
					 
				 </li>
			 </ul>

		</div>
  </div>
	<CartControl/>
</div>	
</template>

<script>
import CartControl from 'components/CartControl/CartControl'
import BScroll from 'better-scroll'
export default {
    data() {
      return {
				isshow:'',
				listHeight:[],//右边每个盒子的高度数组
				scrollY:0,//时时获取当前Y轴的高度

      }
		},

	mounted(){
		
		this.$nextTick(()=>{
			this._getHeight()
			this._scroll()
		})

	},
	methods:{
		// better-scroll的实现原理是监听了touchStart touchend事件 所以阻止了默认的事件(PrenvetDefault)
		// 所以在这里点击的话 需要在初始的时候传递click，派发一个点击事件
		_scroll(){
		
		this.scroll=new BScroll(this.$refs.menu_wrapper,{
			scrollY:true,
			click:true,
			probeType:1
		})
			// 把BScroll添加到当前的页面实例对象上
			this.rScroll=new BScroll(this.$refs.food_wrapper,{
			probeType:3  //探针的效果时时获取滚动的高度
		})
		// this.rScroll这个对象监听事件 时时获取位置 获取到滚到的高度 scrollTop
		this.rScroll.on('scroll',(pos)=>{
			this.scrollY=Math.abs(Math.round(pos.y))
		})
		},
	
	//获取右边滚动盒子的高度
  _getHeight(){
		// $refs是获取DOM元素对象的
		let itemArr=this.$refs.food_wrapper.getElementsByClassName('food-item')
		let height=0
		this.listHeight.push(height)
	   Array.prototype.slice.call(itemArr).forEach((item)=>{
		 height+=item.clientHeight
		 this.listHeight.push(height)
		})
	}
	},

	computed: {
		currentIndex(){
			 
		 for(var i=0;i<this.listHeight.length;i++){
		 
		 let height=this.listHeight[i]
		 let height2=this.listHeight[i+1]

		 if(!height2||(this.scrollY>=height && this.scrollY<height2)){

      return i

		 }

		 }

			return 0
		}
	},
	components:{
		CartControl
	}
	

}

</script>
<style lang='stylus' rel='stylesheet/stylus'>
.shopgoods
	width 100%
	position absolute
	top 5.866667rem
	bottom 1.226667rem
	display flex
	overflow hidden
	.menu-wrapper
		flex-basis 2.133333rem
		ul
			background #ffffff
			.menu-item
				display flex
				font-size .32rem
				width 100%
				height 1.333333rem
				justify-content center
				align-items center
				position relative
				&:not(:last-child):after
					content ''
					width 70%
					height .026667rem
					background #EBEDEF
					position absolute
					bottom 0
				.icon
					width .32rem
					height .32rem
					margin-right .133333rem

	.food-wrapper
		flex 1
		.food-item
			display flex
			flex-flow column
			.food-title
				background  #F3F5F7
				height .693333rem
				font-size .32rem
				position relative
				display flex
				align-items center
				text-indent .4rem
				&:after
					content ''
					width .053333rem
					height 70%
					background #ccc
					position absolute
					left 0
			.food-list
				padding .4rem
				box-sizing border-box
				display flex
				position relative
				background #fff
				&:not(:last-child):after
					content ''
					width 90%
					position absolute
					height .026667rem
					background #F7F7F7
					bottom 0
					
				.food-avatar
					flex-basis 1.52rem
					height 1.52rem
					img 
						width 100%
						height 100%
				.food-text
					flex 1
					.food-line
						width 100%
						display flex
						flex-flow column
						font-size .32rem
						margin-left .133333rem
						>li:not(:last-child)
							margin-bottom .133333rem
						.line-title
							font-weight 700
						.line-des
							color #ADB1B6
						.line-num
							font-size .266667rem
							color #ADB1B6
						.line-order
							color red	
						





		
		
</style>